# -*- coding: utf-8 -*-
"""Dataset_retrieval

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1IETcIm-Rkd6lOOpmzfHF-b1Hpd95uQL8
"""

import json
import pandas as pd

# -------- FILE PATHS --------
INPUT_FILE = "HotelRec_15000.txt"
OUTPUT_FILE = "HotelRec_10k_clean.csv"

records = []

# -------- READ JSON-LINES TXT FILE --------
with open(INPUT_FILE, "r", encoding="utf-8") as f:
    for line in f:
        line = line.strip()

        # Skip empty lines
        if not line:
            continue

        try:
            data = json.loads(line)

            # Extract only required fields
            hotel_url = data.get("hotel_url")
            text = data.get("text")
            rating = data.get("rating")

            if hotel_url and text and rating is not None:
                records.append({
                    "hotel_url": hotel_url,
                    "text": text,
                    "rating": rating
                })

        except json.JSONDecodeError:
            # Skip malformed lines safely
            continue

# -------- CREATE DATAFRAME --------
df = pd.DataFrame(records)

# Convert rating to numeric
df["rating"] = pd.to_numeric(df["rating"], errors="coerce")

# Drop rows with missing values
df = df.dropna(subset=["hotel_url", "text", "rating"])

# -------- OPTIONAL: TAKE FIRST 10,000 (ALREADY 10k, BUT SAFE) --------
df = df.iloc[:10000]

# -------- SAVE AS CSV --------
df.to_csv(OUTPUT_FILE, index=False, encoding="utf-8")

# -------- VALIDATION --------
print("âœ… Conversion successful!")
print("Total reviews:", len(df))
print("Columns:", df.columns.tolist())
print("\nSample rows:")
print(df.head())

import pandas as pd

# -------- STEP 1: LOAD CSV --------
input_file = "HotelRec_10k_.csv"
output_file = "HotelRec_10k_filtered.csv"

df = pd.read_csv(input_file)

# -------- STEP 2: CALCULATE WORD COUNT --------
df['word_count'] = df['text'].astype(str).apply(lambda x: len(x.split()))

# -------- STEP 3: FILTER REVIEWS (<= 1000 words) --------
df_filtered = df[df['word_count'] <= 1000]

# -------- STEP 4: DROP HELPER COLUMN --------
df_filtered = df_filtered.drop(columns=['word_count'])

# -------- STEP 5: SAVE CLEANED FILE --------
df_filtered.to_csv(output_file, index=False, encoding="utf-8")

# -------- STEP 6: VALIDATION --------
print("Original number of reviews:", len(df))
print("After removing long reviews:", len(df_filtered))
print("Removed reviews:", len(df) - len(df_filtered))

print("\nSample rows:")
print(df_filtered.head())