# -*- coding: utf-8 -*-
"""LLM.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/17Fyh8_MNs0P06e4jck3rVeqamZpK_Ccj
"""

import pandas as pd

# =====================================
# STEP 1: LOAD FULL DATASET
# =====================================
# HotelRec.csv must contain at least: text, rating
df = pd.read_csv("/content/HotelRec_10k_final.csv")

print("Total reviews in dataset:", len(df))


# =====================================
# STEP 2: SAMPLE 2000 REVIEWS FOR LLM EXAMPLES
# (Example-based learning, NOT training)
# =====================================
sampled_df = df.sample(
    n=2000,
    random_state=42
)[['text', 'rating']]

print("LLM example reviews:", len(sampled_df))


# =====================================
# STEP 3: CREATE REMAINING DATA (FOR PREDICTION)
# =====================================
# Remaining reviews with ratings (for evaluation)
test_df = df.drop(sampled_df.index)

# Remaining reviews text only (for LLM input)
remaining_text_df = test_df[['text']]

print("Reviews to predict:", len(test_df))


# =====================================
# STEP 4: SAVE FILES
# =====================================
# 2000 example reviews (used inside LLM prompt)
sampled_df.to_csv("sampled_reviews.csv", index=False)

# Text-only reviews (sent to LLM for prediction)
remaining_text_df.to_csv("remaining_reviews.csv", index=False)

# Ground-truth reviews (used for evaluation)
test_df.to_csv("test_reviews.csv", index=False)


# =====================================
# STEP 5: FINAL VERIFICATION
# =====================================
print("\nFiles generated successfully:")
print("1. sampled_reviews.csv  -> LLM examples (text + rating)")
print("2. remaining_reviews.csv -> LLM prediction input (text only)")
print("3. test_reviews.csv      -> Ground truth for evaluation")

print("\nSanity check:")
print("Example reviews:", len(sampled_df))
print("Prediction reviews:", len(remaining_text_df))
print("Evaluation reviews:", len(test_df))

import pandas as pd
import random

# =====================================
# STEP 1: LOAD FILES
# =====================================
examples_df = pd.read_csv("sampled_reviews.csv")        # text + rating
predict_df = pd.read_csv("remaining_reviews.csv")       # text only

print("Examples loaded:", len(examples_df))
print("Reviews to predict:", len(predict_df))


# =====================================
# STEP 2: BUILD LLM PROMPT
# =====================================
def build_llm_prompt(examples_df, review_text):
    prompt = "You are given hotel reviews with their ratings.\n\nExamples:\n"

    for _, row in examples_df.iterrows():
        prompt += f'Review: "{row["text"]}"\n'
        prompt += f'Rating: {int(row["rating"])}\n\n'

    prompt += (
        "Now predict the rating (1 to 5) for the following review.\n"
        "Return ONLY the number.\n\n"
        f'Review: "{review_text}"'
    )

    return prompt


# =====================================
# STEP 3: SIMULATED LLM CALL
# (Replace later with real LLM API)
# =====================================
def call_llm(prompt):
    # Simulating LLM output
    return random.randint(1, 5)


# =====================================
# STEP 4: GENERATE PREDICTIONS
# =====================================
predictions = []

for idx, row in predict_df.iterrows():
    review_text = row["text"]
    prompt = build_llm_prompt(examples_df, review_text)
    predicted_rating = call_llm(prompt)
    predictions.append(predicted_rating)

    if idx % 100 == 0:
        print(f"Processed {idx} reviews")


# =====================================
# STEP 5: SAVE OUTPUT
# =====================================
pred_df = pd.DataFrame({
    "predicted_rating": predictions
})

pred_df.to_csv("predicted_ratings_llm2000.csv", index=False)

print("\nâœ… File created: predicted_ratings_llm2000.csv")
print("Total predictions:", len(pred_df))

import pandas as pd
from sklearn.metrics import (
    accuracy_score,
    mean_absolute_error,
    mean_squared_error,
    cohen_kappa_score
)
import numpy as np

# =====================================
# STEP 1: LOAD FILES
# =====================================
pred = pd.read_csv("predicted_ratings_llm2000.csv")
real = pd.read_csv("test_reviews.csv")

y_pred = pred["predicted_rating"]
y_true = real["rating"]

print("Predictions:", len(y_pred))
print("Ground truth:", len(y_true))


# =====================================
# STEP 2: METRICS
# =====================================
accuracy = accuracy_score(y_true, y_pred)
mae = mean_absolute_error(y_true, y_pred)
rmse = np.sqrt(mean_squared_error(y_true, y_pred))
kappa = cohen_kappa_score(y_true, y_pred)


# =====================================
# STEP 3: PRINT RESULTS
# =====================================
print("\nðŸ“Š LLM Evaluation Results")
print(f"Accuracy      : {accuracy:.4f}")
print(f"MAE           : {mae:.4f}")
print(f"RMSE          : {rmse:.4f}")
print(f"Cohenâ€™s Kappa : {kappa:.4f}")


# =====================================
# STEP 4: SAVE METRICS (OPTIONAL)
# =====================================
metrics_df = pd.DataFrame({
    "Accuracy": [accuracy],
    "MAE": [mae],
    "RMSE": [rmse],
    "Cohen_Kappa": [kappa]
})

metrics_df.to_csv("llm_metrics.csv", index=False)

print("\nâœ… Metrics saved to llm_metrics.csv")